<app-header></app-header>

<div class="products-page-wrapper">
  <!-- Hero -->
  <section class="products-hero">
    <h1>Welcome to Our Store</h1>
    <p>Discover the best products we have to offer.</p>
  </section>

  <!-- Filters -->
  <div class="filter-bar card">
    <div class="search-bar">
      <input type="text" placeholder="Search products..." [(ngModel)]="searchTerm" (input)="filterProducts()" />
    </div>

    <select [(ngModel)]="selectedFilter" (change)="onFilterChange()" class="filter-dropdown" required
      [ngClass]="{ 'placeholder': !selectedFilter }">
      <option [ngValue]="''" disabled>Sort By</option>
      <option value="price-asc">Price: Low to High</option>
      <option value="price-desc">Price: High to Low</option>
      <option value="qty">Quantity Available</option>
    </select>
  </div>

  <div class="section-divider"></div>

  <!-- Grid -->
  <h2 class="section-title">Available Products</h2>
  <div class="products-grid">
    <article class="product-card card" *ngFor="let product of filteredProducts">
      <div class="product-media">
        <img [src]="getImageUrl(product.imageURL)" alt="{{ product.name }}" />
      </div>

      <div class="product-body">
        <h3 class="product-title">{{ product.name }}</h3>
        <p class="product-desc">{{ product.description }}</p>

        <div class="price-row">
          <span class="price">${{ product.price }}</span>
          <span class="stock">In stock: {{ product.qty }}</span>
        </div>

        <div class="qty-row">
          <input type="number" [(ngModel)]="product.inputQty" (ngModelChange)="product.inputQty = toNum($event)"
            placeholder="Qty" min="1" class="qty-input">
          <button class="btn primary-cta"
            [disabled]="toNum(product.inputQty) <= 0 || toNum(product.inputQty) > toNum(product.qty)"
            (click)="addProduct(product.id, product.inputQty)">
            Add to Cart
          </button>
        </div>

        <div class="msg-row">
          <div *ngIf="toNum(product.inputQty) > toNum(product.qty)" class="msg error">Not enough stock available.</div>
          <div *ngIf="toNum(product.inputQty) <= 0" class="msg error">Please enter a valid quantity.</div>
          <div *ngIf="toNum(product.inputQty) > 0 && toNum(product.inputQty) <= toNum(product.qty)" class="msg ok">
            Available for purchase.
          </div>
        </div>
      </div>
    </article>
  </div>

  <div *ngIf="!filteredProducts?.length" class="empty-state card">
    <p>No products match your filters. Try clearing the search or changing the sort.</p>
  </div>
</div>

<app-footer></app-footer>