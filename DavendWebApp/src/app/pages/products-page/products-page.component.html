<app-header></app-header>

<div class="products-page-wrapper">
  <!-- Hero -->
  <section class="products-hero">
    <h1>Welcome to Our Store</h1>
    <p>Discover the best products we have to offer.</p>
  </section>

  <!-- Filters -->
  <div class="filter-bar card">
    <div class="search-bar">
      <input
        type="text"
        placeholder="Search products..."
        [(ngModel)]="searchTerm"
        (input)="filterProducts()"
      />
    </div>

    <select
      [(ngModel)]="selectedFilter"
      (change)="onFilterChange()"
      class="filter-dropdown"
      required
      [ngClass]="{ placeholder: !selectedFilter }"
    >
      <option [ngValue]="''" disabled>Sort By</option>
      <option value="price-asc">Price: Low to High</option>
      <option value="price-desc">Price: High to Low</option>
      <option value="qty">Quantity Available</option>
    </select>
  </div>

  <div class="section-divider"></div>

  <!-- Grid -->
  <h2 class="section-title">Available Products</h2>
  <div class="products-grid">
    <article class="product-card card" *ngFor="let product of filteredProducts">
      <div class="product-media carousel-wrapper">
        <!-- Left Arrow -->
        <button class="nav-arrow left" (click)="prevImage(product)">‹</button>

        <!-- Image Display -->
        <div class="fade-container">
          <img
            [src]="getProductImage(product)"
            alt="{{ product.name }}"
            class="carousel-image fade-image"
            [class.fade-in]="product.fadeState === 'in'"
            [class.fade-out]="product.fadeState === 'out'"
          />
        </div>

        <!-- Right Arrow -->
        <button class="nav-arrow right" (click)="nextImage(product)">›</button>
      </div>

      <div class="product-body">
        <h3 class="product-title">{{ product.name }}</h3>
        <p class="product-desc">{{ product.description }}</p>

        <div class="price-row">
          <span class="price"
            >${{ product.selectedVariant?.price || product.price }}</span
          >
        </div>

        <!-- Variant selector -->
        <div class="variant-row" *ngIf="product.ProductVariants?.length">
          <label>Choose size:</label>
          <select [(ngModel)]="product.selectedVariant">
            <option *ngFor="let v of product.ProductVariants" [ngValue]="v">
              {{ v.size }} - {{ v.length_value }}
            </option>
          </select>
        </div>

        <div class="qty-row">
          <input
            type="number"
            [(ngModel)]="product.inputQty"
            (ngModelChange)="product.inputQty = toNum($event)"
            placeholder="Qty"
            min="1"
            class="qty-input"
          />
          <button
            class="btn primary-cta"
            [disabled]="
              toNum(product.inputQty) <= 0 ||
              (product.selectedVariant
                ? toNum(product.inputQty) > toNum(product.selectedVariant.qty)
                : toNum(product.inputQty) > toNum(product.qty))
            "
            (click)="
              addProduct(
                product.selectedVariant?.id || product.id,
                product.inputQty
              )
            "
          >
            Add to Cart
          </button>
        </div>
      </div>

      <div class="msg-row">
        <div
          *ngIf="
            product.selectedVariant &&
            toNum(product.inputQty) > product.selectedVariant.qty
          "
          class="msg error"
        >
          Not enough stock available.
        </div>

        <div
          *ngIf="
            !product.selectedVariant && toNum(product.inputQty) > product.qty
          "
          class="msg error"
        >
          Not enough stock available.
        </div>

        <div *ngIf="toNum(product.inputQty) <= 0" class="msg error">
          Please enter a valid quantity.
        </div>
      </div>
    </article>
  </div>

  <div class="pagination-container" *ngIf="totalPages > 1">
    <button
      class="page-btn"
      [disabled]="currentPage === 1"
      (click)="prevPage()"
    >
      ‹ Prev
    </button>

    <span class="page-info"> Page {{ currentPage }} of {{ totalPages }} </span>

    <button
      class="page-btn"
      [disabled]="currentPage === totalPages"
      (click)="nextPage()"
    >
      Next ›
    </button>
  </div>

  <div *ngIf="!filteredProducts.length" class="empty-state card">
    <p>
      No products match your filters. Try clearing the search or changing the
      sort.
    </p>
  </div>
</div>

<app-footer></app-footer>
