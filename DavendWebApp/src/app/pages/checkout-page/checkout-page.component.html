<app-header></app-header>

<div class="checkout-container">
  <h1>Your Shopping Cart</h1>

  <div *ngIf="cartItems.length === 0">
    <p>Your cart is empty.</p>
  </div>

  <div *ngFor="let item of cartItems" class="checkout-card">
    <img [src]="getImageUrl(item.imageURL)" class="product-image">

    <div class="product-details">
      <h2>{{ item.name }}</h2>
      <p>{{ item.description }}</p>
      <p *ngIf="item.price != null">Price per unit: ${{ item.price.toFixed(2) }}</p>
      <p>Quantity: {{ item.qty }}</p>
      <p>Total for this product: ${{ item.totalPrice.toFixed(2) }}</p>

      <div class="remove-control">
        <input type="number" min="1" [max]="item.qty" [(ngModel)]="item.removeQty">
        <button (click)="removeFromCart(item.id, item.removeQty)">Remove</button>
      </div>
    </div>
  </div>  

  <div class="subtotal" *ngIf="cartItems.length >= 0">
    <h2>Subtotal: ${{ total.toFixed(2) }}</h2>
  </div>
<form [formGroup]="checkoutForm" *ngIf="cartItems.length >= 0" class="quote-form">
  <h2>Product Quote / Request Form</h2>

  <!-- Full Name + Email -->
  <div class="form-row">
    <div class="form-group">
      <label>Full Name</label>
      <input formControlName="fullName" type="text" required />
    </div>

    <div class="form-group">
      <label>Email</label>
      <input formControlName="email" type="email" required />
    </div>
  </div>

  <!-- Phone -->
  <div class="form-group">
    <label>Phone Number</label>
    <input formControlName="phone" type="tel" placeholder="(xxx) xxx-xxxx" />
  </div>

  <!-- Address -->
  <div class="form-group">
    <label>Address</label>
    <input formControlName="address" type="text" required />
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>City*</label>
      <input formControlName="city" type="text" required />
    </div>
    <div class="form-group">
      <label>Postal Code*</label>
      <input formControlName="postalCode" type="text" required />
    </div>
  </div>

  <!-- Payment Methods -->
  <div class="form-group payment-methods">
    <label>Payment Method</label>
    <label>
      <input type="radio" formControlName="method" value="CARD" />
      <span>üí≥ Credit Card</span>
    </label>
    <label>
      <input type="radio" formControlName="method" value="PAYPAL" />
      <span>üÖøÔ∏è PayPal</span>
    </label>
    <label>
      <input type="radio" formControlName="method" value="ETRANSFER" />
      <span>üè¶ E-Transfer</span>
    </label>
  </div>

  <!-- Message -->
  <div class="form-group">
    <label>Message</label>
    <textarea formControlName="message" rows="4"></textarea>
  </div>

  <!-- Submit -->
  <button (click)="payNow()"  class="submit-btn">
    {{ isProcessing ? 'Processing‚Ä¶' : 'Submit' }}
  </button>
</form>

  <!-- Error -->
  <div *ngIf="errorMsg" class="error">
    {{ errorMsg }}
  </div>

  <!-- Pending E-Transfer Instructions -->
  <div *ngIf="pendingInfo" class="pending-card">
    <h2>Complete Your e-Transfer</h2>
    <p>Amount Due: <strong>{{ pendingInfo.amount | currency:'CAD' }}</strong></p>
<p>Recipient: <strong>pay&#64;yourdomain.com</strong></p>
    <p>Reference Code: <strong>{{ pendingInfo.reference }}</strong></p>
    <p>Deadline: {{ pendingInfo.deadlineISO | date:'short' }}</p>
    <p>
      We‚Äôve emailed you these instructions. Once we confirm your payment, a
      receipt will be sent to your inbox.
    </p>
  </div>
</div>

<app-footer></app-footer>
