<div class="inventory-container">
  <h2>Manage Inventory</h2>

  <!-- Navigation Buttons -->
  <div class="nav-buttons">
      <button routerLink="/" class="home-btn">üè† Home</button>
      <button (click)="logout()" class="logout-btn">üö™ Logout</button>
  </div>

  <!-- Add Product Form -->
  <div class="add-product">
      <h3>Add Product</h3>
      <input type="text" placeholder="Name" [(ngModel)]="newProduct.name">
      <input type="text" placeholder="Description" [(ngModel)]="newProduct.description">
      <input type="number" placeholder="Price" [(ngModel)]="newProduct.price">
      <input type="number" placeholder="Quantity" [(ngModel)]="newProduct.qty">
      <input 
        type="file" 
        accept=".jpg,.jpeg,.pdf,image/jpeg,application/pdf"
        (change)="handleImageUpload($event)">

        <!-- Image Preview -->
         <div *ngIf="addPreviewUrl" class="preview-wrap">
            <div *ngIf="!addPreviewIsPdf">
              <img [src]="addPreviewUrl" alt="Selected Image Preview" class="preview-img" />
            </div>
            <div *ngIf="addPreviewIsPdf" class="pdf-preview">
              <embed [src]="addPreviewTrustedUrl" type="application/pdf" class="pdf-embed" />
            </div>

            <div class="preview-actions">
              <button type="button" (click)="triggerAddReupload()">Choose different file</button>
              <button type="button" (click)="cancelAddImage()">Cancel image</button>
            </div>
         </div>

         <!-- warning if no image is selected on submit -->
          <div *ngIf="showAddImageWarning" class="warn">
            You‚Äôre creating a product without an image. Continue anyway?
            <button type="button" (click)="proceedWithoutImage()">Yes, continue</button>
            <button type="button" (click)="showAddImageWarning=false">Cancel</button>
          </div>

          <!-- Hidden re-upload input (triggered by button above) -->
          <input
            #addReuploadInput
            type="file"
            accept=".jpg,.jpeg,.pdf,image/jpeg,application/pdf"
            (change)="handleImageUpload($event)"
            style="display:none"
          />

      <button (click)="addProduct()">Add Product</button>
  </div>

  <hr>

  <!-- Product List -->
  <h3>Products</h3>
  <table border="1">
      <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Description</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Image</th>
            <th>Actions</th>
      </tr>
      <tr *ngFor="let product of products">
            <td>{{ product.id }}</td>
            <td>{{ product.name }}</td>
            <td>{{ product.description }}</td>
            <td>{{ product.price }}</td>
            <td>{{ product.qty }}</td>
            <td><img [src]="getImageUrl(product.imageURL)" class="product-img"></td>
            <td>
              <button (click)="editProduct(product)" class="edit-btn">Edit</button>
              <button (click)="deleteProduct(product.id)" class="action-btn">Delete</button>
            </td>
      </tr>
  </table>

  <!-- Edit Product Form -->
  <div *ngIf="editingProduct" class="edit-product">
    <h3>Edit Product</h3>
    <input type="text" [(ngModel)]="editingProduct.name">
    <input type="text" [(ngModel)]="editingProduct.description">
    <input type="number" [(ngModel)]="editingProduct.price">
    <input type="number" [(ngModel)]="editingProduct.qty">

    <!-- Optional new image upload -->
    <input 
      type="file" 
      accept=".jpg,.jpeg,.pdf,image/jpeg,application/pdf"
      (change)="handleEditImageUpload($event)">

      <!-- Edit Image Preview -->
      <div *ngIf="editPreviewUrl" class="preview-wrap">
        <div *ngIf="!editPreviewIsPdf">
          <img [src]="editPreviewUrl" alt="Selected image preview" class="preview-img" />
        </div>
        <div *ngIf="editPreviewIsPdf" class="pdf-preview">
          <embed [src]="editPreviewTrustedUrl" type="application/pdf" class="pdf-embed" />
        </div>

        <div class="preview-actions">
          <button type="button" (click)="triggerEditReupload()">Choose different file</button>
          <button type="button" (click)="cancelEditImage()">Cancel image</button>
        </div>
      </div>

      <!-- Hidden re-upload input -->
      <input
        #editReuploadInput
        type="file"
        accept=".jpg,.jpeg,.pdf,image/jpeg,application/pdf"
        (change)="handleEditImageUpload($event)"
        style="display:none"
      />

    <button (click)="saveEdit()">Save</button>
    <button (click)="editingProduct = null">Cancel</button>
  </div>

</div>
